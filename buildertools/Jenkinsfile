pipeline
{
	agent any
	stages 
	{
		stage('Builder') 
		{
			environment
			{
				SAUCE_ACCESS = credentials('mydtr_cre')
				IMAGE_NAME = 'dcdevjbz/msbuild15:ver15.4.8.50001_wincore1709'
			}
			steps 
			{
				script
				{
					// withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'mydtr_cre',
					// 		usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']]) 
					// {
					// }
					powershell 'if(( docker images -q ${IMAGE_NAME} ) -eq $null ) 
								{
									docker build -f ${PWD}\\buildertools\\basicbuilder\\Dockerfile -t ${IMAGE_NAME} ${PWD}\\buildertools\\basicbuilder; 
								 	${env:SAUCE_ACCESS_PSW} | docker login --username ${env:SAUCE_ACCESS_USR} --password-stdin;
									docker push ${IMAGE_NAME}
								} 
								else {"found ${IMAGE_NAME}"}'
				}
			}
		}
	}
}