pipeline
{
	agent any
	stages 
	{
		stage('Builder') 
		{
			environment
			{
				SAUCE_ACCESS = credentials('mydtr_cre')
				IMAGE_NAME = "dcdevjbz/msbuild15:ver15.4.8.50001_wincore1709"
			}
			steps 
			{
				script
				{
					// withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'mydtr_cre',
					// 		usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']]) 
					// {
					// }
					powershell 'if(( docker images -q '${env:IMAGE_NAME}') -eq $null ) 
								{
									docker build -f ${PWD}\\buildertools\\basicbuilder\\Dockerfile -t ${env:IMAGE_NAME} ${PWD}\\buildertools\\basicbuilder; 
								 	${env:SAUCE_ACCESS_PSW} | docker login --username ${env:SAUCE_ACCESS_USR} --password-stdin;
									docker push ${env:IMAGE_NAME}
								} 
								else {"found ${env:IMAGE_NAME}"}'
				}
			}
		}
	}
}